// Generated by CoffeeScript 1.10.0
(function(window, $) {
  var htmlBody, win;
  win = $(window);
  htmlBody = $('html, body');
  return ($('body')).on('submit', '.vote-form', function(e) {
    var action, data, el, item, itemId, reloadCallback, res;
    e.preventDefault();
    el = $(this);
    item = el.parents('.item');
    itemId = item.attr('id');
    action = el.attr('action');
    data = el.serialize();
    res = $.post(action, data);
    reloadCallback = $.afterNCalls(2, function() {
      item = $("#" + itemId);
      htmlBody.animate({
        scrollTop: item.offset().top
      }, 1000);
      item.addClass('highlighted');
      setTimeout(function() {
        return item.removeClass('highlighted');
      }, 4000);
    });
    res.done(function() {
      $.popup($.template('vote-success'));
      ($('#review')).reload(reloadCallback);
      ($('#candidates')).reload(reloadCallback);
    });
    res.fail(function() {
      $.popup($.template('vote-fail'));
    });
  });
})(this, this.jQuery);
