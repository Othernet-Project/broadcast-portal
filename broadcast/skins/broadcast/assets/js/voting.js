// Generated by CoffeeScript 1.10.0
(function(window, $) {
  var candidates, getReloadCallback, listCount, review;
  review = $('#review');
  candidates = $('#candidates');
  listCount = review.length + candidates.length;
  getReloadCallback = function(itemId) {
    return $.afterNCalls(listCount, function() {
      var item;
      item = $("#" + itemId);
      item.scrollTo(function() {
        item.addClass('highlighted');
        setTimeout(function() {
          item.removeClass('highlighted');
        }, 4000);
      });
    });
  };
  return ($('body')).on('click', '.vote-icon', function(e) {
    var action, button_value, el, form, item, itemId, reloadCallback, res;
    e.preventDefault();
    el = $(this);
    form = el.parents('.vote-form');
    item = el.parents('.item');
    itemId = item.attr('id');
    action = form.attr('action');
    button_value = el.val();
    reloadCallback = getReloadCallback(itemId);
    res = $.post(action, {
      upvote: button_value
    });
    res.done(function() {
      $.popup($.template('vote-success'));
      review.reload(reloadCallback);
      candidates.reload(reloadCallback);
    });
    res.fail(function() {
      $.popup($.template('vote-fail'));
    });
  });
})(this, this.jQuery);
