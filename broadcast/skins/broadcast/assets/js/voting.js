// Generated by CoffeeScript 1.10.0
(function(window, $) {
  var body, candidates, lastVotedItem, listCount, onRocaLoad, onVote, review, win;
  win = $(window);
  body = $('body');
  review = $('#review');
  candidates = $('#candidates');
  listCount = review.length + candidates.length;
  lastVotedItem = null;
  onRocaLoad = function(e, parent) {
    var item;
    if (lastVotedItem === null) {
      return;
    }
    item = parent.find("#" + lastVotedItem);
    if (!item.length) {
      return;
    }
    lastVotedItem = null;
    item.scrollTo(function() {
      item.addClass('highlighted');
      setTimeout(function() {
        item.removeClass('highlighted');
      }, 4000);
    });
  };
  onVote = function(e) {
    var action, button_value, el, form, item, itemId, res;
    e.preventDefault();
    el = $(this);
    form = el.parents('.vote-form');
    item = el.parents('.item');
    itemId = item.attr('id');
    action = form.attr('action');
    button_value = el.val();
    res = $.post(action, {
      upvote: button_value
    });
    res.done(function() {
      lastVotedItem = itemId;
      win.trigger('vote-submit');
      $.popup($.template('vote-success'));
      $.forceStateUpdate();
    });
    res.fail(function() {
      $.popup($.template('vote-fail'));
    });
  };
  win.on('review-roca-load', onRocaLoad);
  win.on('candidates-roca-load', onRocaLoad);
  return body.on('click', '.vote-icon', onVote);
})(this, this.jQuery);
