// Generated by CoffeeScript 1.10.0
(function(window, $) {
  var RELOAD_INTERVAL, body, lastUpdate, reloadState, scheduleReload, stateReloaded, timer, updateURL, win;
  RELOAD_INTERVAL = 10000;
  win = $(window);
  body = $('body');
  lastUpdate = parseInt(body.data('last-update'), 10);
  updateURL = body.data('update-url');
  timer = null;
  reloadState = function(forced) {
    return $.getJSON(updateURL, function(data) {
      data.forced = forced;
      return stateReloaded(data);
    });
  };
  stateReloaded = function(data) {
    if (lastUpdate === data.timestamp) {
      return;
    }
    win.trigger('state-update', [data]);
    lastUpdate = data.timestamp;
  };
  scheduleReload = function() {
    return timer = setInterval(reloadState, RELOAD_INTERVAL);
  };
  $.forceStateUpdate = function() {
    clearTimeout(timer);
    reloadState(true);
    return scheduleReload();
  };
  return scheduleReload();
})(this, this.jQuery);
