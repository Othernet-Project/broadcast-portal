// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  'use strict';
  var actionFormSelector, getFormData, handles, modifyQueue, queues, searchForm, searchQTElem, searchUrl;
  queues = $('.queue');
  handles = $('.handles a.handle');
  searchForm = $('.search form');
  searchUrl = searchForm.attr('action');
  searchQTElem = $('.search input#type');
  actionFormSelector = '.action form';
  getFormData = function(form) {
    var arr, data;
    data = {};
    arr = form.serializeArray();
    $(arr).each(function(index, obj) {
      return data[obj.name] = obj.value;
    });
    return data;
  };
  modifyQueue = function(e) {
    var actionUrl, btn, form, formData, res;
    e.preventDefault();
    form = $(this);
    btn = form.find('button');
    formData = getFormData(form);
    formData[btn.attr('name')] = btn.val();
    actionUrl = form.attr('action');
    res = $.ajax(actionUrl, {
      method: 'POST',
      data: formData
    });
    res.done(function(data) {
      var row;
      row = form.parents('tr');
      return row.remove();
    });
    return res.fail(function() {
      return alert(templates.queueModifyError);
    });
  };
  handles.on('click', function(e) {
    var container, elem, res, target, url;
    e.preventDefault();
    elem = $(this);
    target = elem.data('target');
    container = queues.filter('.' + target);
    if (container.hasClass('hidden')) {
      url = elem.attr('href');
      handles.removeClass('active');
      elem.addClass('active');
      queues.addClass('hidden');
      container.removeClass('hidden');
      res = $.get(url);
      res.done(function(data) {
        var actionForms;
        container.html(data);
        actionForms = $(actionFormSelector);
        actionForms.off('submit', modifyQueue);
        return actionForms.on('submit', modifyQueue);
      });
      return res.fail(function() {
        return container.html(templates.queueLoadError);
      });
    }
  });
  return searchForm.on('submit', function(e) {
    var container, formData, res;
    e.preventDefault();
    container = queues.not('.hidden');
    formData = getFormData(searchForm);
    formData.type = container.data('source');
    res = $.ajax(searchUrl, {
      method: 'GET',
      data: formData
    });
    res.done(function(data) {
      return container.html(data);
    });
    return res.fail(function() {
      return container.html(templates.queueLoadError);
    });
  });
})(this, this.jQuery, this.templates);
